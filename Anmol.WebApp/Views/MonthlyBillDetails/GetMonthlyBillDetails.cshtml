@using _Anmol.Common;

@{
    ViewBag.Title = "GetMonthlyBillDetails";
    Layout = "~/Views/Shared/_LayoutForCustomer.cshtml";
}



<style>
    .dataTables_filter input {
        outline: 0;
        width: 200px;
        padding: 7px 12px;
        border: 1px solid #ddd;
        border-radius: 3px;
    }
</style>

<div class="row pt-4">
    <div class="col-12 ">
        <div class="ibox">
            <div class="ibox-title collapse-link">
                <h5>Search Monthly Bill</h5>
                <div class="ibox-tools">
                    <a class="">
                        <i class="fa fa-chevron-down"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content" style="display: none;">
                <div class="row">
                    <div class="col-md-3 form-group">
                        <label>Customer Name</label>
                        @Html.DropDownList("CustName", new SelectList((IEnumerable<SelectListItem>)ViewBag.CustomerList, "Value", "Text"), "--- Select Customer ---", new { @class = "form-control" })
                    </div>
                    <div class="col-md-3 form-group">
                        <label>Start Date</label>
                        @Html.TextBox("BillMonth", null, new { @class = "form-control", @type = "month", @placeholder = "Select month" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-right">
                        <button class="btn btn-primary" onclick="BindMonthlyBillGrid()">Search</button>
                        <button class="btn btn-secondary" onclick="ClearSearchData()">Clear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="ibox">
            <div class="ibox-content">
                <div class="table-responsive">
                    <table id="tblMonthlyBill" class="table table-bordered display w-100 mb-4">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Total Quantity</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    $(document).ready(function () {
        BindMonthlyBillGrid();
    });
    function BindMonthlyBillGrid() {
        //debugger;
        $.ajax({
            url: encodeURI('@Url.Action(ActionHelper.Index, ControllerHelper.MonthlyBillDetails)'),
            type: "GET",
            data: {
                CustName: $('#CustName').val(),
                BillMonth: $('#BillMonth').val()
            },
            dataType: "json",
            success: GetData
        });
    }

    function GetData(data) {
        try {

            var dt = $('#tblMonthlyBill').DataTable();
                 if (dt != 'undefined') {
                    dt.destroy();
                    }
            dt = $('#tblMonthlyBill').DataTable({
                "lengthMenu": [50, 100, 200, 500],
                "pageLength": 50,
                "order": [0, 'desc'],
                "dom": 'frtlip',
                "bFilter": true,
                "autoWidth": true,
                "aaData": data.Data,
                "aoColumns": [
                    {
                        "mData": "CustName"
                    },
                    {
                        "mData": "TotalQuantity"
                    },
                    {
                        "mData": "TotalAmount"
                    },
                ]
            });
            $(".dataTables_length").css('clear', 'none');
            $(".dataTables_length").css('margin-right', '20px');
            $(".dataTables_info").css('clear', 'none');
            $(".dataTables_info").css('padding', '0');
        } catch (e) {
            alert(e.message);
        }
    }


    function ClearSearchData() {
        $("#CustName").val("");
        $("#BillMonth").val("");
        BindMonthlyBillGrid();
    }
</script>

