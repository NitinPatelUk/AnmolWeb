@using _Anmol.Common;
@{
    ViewBag.Title = "GetMilkOrderDetail";
    Layout = "~/Views/Shared/_LayoutForCustomer.cshtml";
}

<div class="row d-flex justify-content-end">
    @*<div class="col-sm-2 col-6">
        <p>Today Order</p>
        <h3 class="font-weight-bold">10</h3>
    </div>*@
    <div class="col-sm-2 col=2 mb-2">
        <div class="action-btn">
            <a href="@Url.Action(ActionHelper.GetCustomerTemporaryOrderById, ControllerHelper.CustomerTemporaryOrder)?CustTempOrdId=0" class="btn btn-xl btn-primary m-t-n-xs"><i class="fa fa-plus"></i> Add New Order </a>
        </div>
    </div>
</div>

@*<div class="modal fade" id="temporaryModal" tabindex="-1" role="dialog" aria-labelledby="temporaryModalLebel" aria-hidden="true">
    <div class="modal-dialog ">
        <div class="modal-content ">
            <div class="modal-header ">
                <h5 class="modal-title " id="temporaryModalLebel ">Temparary Order</h5>
                <button type="button" class="btn-close " data-bs-dismiss="modal " aria-label="Close "></button>
            </div>
            <div class="modal-body ">
                <form class="row g-3 ">
                    <div class="col-md-6 ">
                        <label for="formdate " class="form-label ">Form Date</label>
                        <input type="date" class="form-control " id="formdate ">
                    </div>
                    <div class="col-md-6 ">
                        <label for="todate " class="form-label ">To Date</label>
                        <input type="date" class="form-control " id="todate ">
                    </div>
                    <div class="col-md-12 ">
                        <label for="quntity " class="form-label ">Quantity</label>
                        <input type="text" class="form-control " id="quantity ">
                    </div>
                    <div class="col-md-12 ">
                        <label for="reason " class="form-label ">Reason</label>
                        <input type="text" class="form-control " id="reason ">
                    </div>
                </form>
            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-secondary " data-dismiss="modal ">Close</button>
                <button type="button" class="btn btn-primary btn-default">Save</button>
            </div>
        </div>
    </div>
</div>*@

<div class="col-12">
    <div class="ibox">
        <div class="ibox-content">
            <div class="table-responsive">
                <table id="tblCustomerTemporaryOrder" class="table table-bordered display w-100 mb-4">
                    <thead>
                        <tr>
                            <th>Sr. No</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Quantity</th>
                            <th class="text-center" width="80">Actions</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        BindCustomerTemporaryOrderGrid();
    });
    function BindCustomerTemporaryOrderGrid() {
        //debugger;
        $.ajax({
            url: encodeURI('@Url.Action(ActionHelper.GetCustTempOrderByID, ControllerHelper.MilkOrderDetails)'),
            type: "GET",
            dataType: "json",
            success: GetData
        });
    }

    function GetData(data) {
        try {

            var dt = $('#tblCustomerTemporaryOrder').DataTable();
                 if (dt != 'undefined') {
                    dt.destroy();
                    }
            dt = $('#tblCustomerTemporaryOrder').DataTable({
                "lengthMenu": [50, 100, 200, 500],
                "pageLength": 50,
                "order": [0, 'asc'],
                "dom": 'frtlip',
                "bFilter": true,
                "autoWidth": true,
                "aaData": data.Data,
                "aoColumns": [
                    {
                        "data": "id",
                        render: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        "mData": "StartDate",
                        "render": function (data) {
                            if (data === null) return "";
                            var date = new Date(parseInt(data.substr(6)));
                            var month = ("0" + (date.getMonth() + 1)).slice(-2);
                            return ("0" + date.getDate()).slice(-2) + '/' + month + '/' + date.getFullYear();
                        }
                    },
                    {
                        "mData": "EndDate",
                        "render": function (data) {
                            if (data === null) return "";
                            var date = new Date(parseInt(data.substr(6)));
                            var month = ("0" + (date.getMonth() + 1)).slice(-2);
                            return ("0" + date.getDate()).slice(-2) + '/' + month + '/' + date.getFullYear();
                        }
                    },
                    {
                        "mData": "Quantity"
                    },
                    {
                        "mData": "CustID",
                        "className": "dt-center",
                        "orderable": false,
                        "render": function (data, type, row, meta) {
                            var ActionButtonEdit = '<a href="@Url.Action(ActionHelper.GetCustomerTemporaryOrderById, ControllerHelper.CustomerTemporaryOrder)?CustTempOrdId=' + row.CustTempOrdId+'" title="Edit Customer Temporary Order"   class="btn-link btn-sm px-1"><i class="fa fa-pencil text-primary"></i></a>';
                            var ActionButtonDelete = '<a title="Delete Customer Temporary Order" onclick="deleteCustomerTemporaryOrderClick(\'' + row.CustTempOrdId + '\')" class="btn-link btn-sm px-1"><i class="fa fa-trash text-primary"></i></a>';
                            var result =  ActionButtonEdit;
                            result = result + ActionButtonDelete;
                            return result;
                        }
                    }
                ]
            });
            $(".dataTables_length").css('clear', 'none');
            $(".dataTables_length").css('margin-right', '20px');
            $(".dataTables_info").css('clear', 'none');
            $(".dataTables_info").css('padding', '0');
        } catch (e) {
            alert(e.message);
        }
    }

    function deleteCustomerTemporaryOrderClick(CustTempOrdId) {
       // debugger;
        bootbox.confirm("Are you sure you want to delete this record?", function (result) {
            if (result) {
                $.ajax({
                    url: '@Url.Action(ActionHelper.DeleteCustomerTemporaryOrder, ControllerHelper.CustomerTemporaryOrder)',
                    async: false,
                    type: 'POST',
                    data: {
                        CustTempOrdId: CustTempOrdId,
                    },
                    success: function (data) {
                        if (data.Flag) {
                            BindCustomerTemporaryOrderGrid();
                            toastr.success("Customer Temporary Order deleted successfully.");
                        }
                        else {
                            toastr.error("Something Went Wrong.");
                        }
                    }
                });
            }
        });
    }

    function ClearSearchData() {
        $("#CustName").val("");
        $("#DeliveryTime").val("");
        $("#StartDate").val("");
        $('#EndDate').val("");
        BindCustomerTemporaryOrderGrid();
    }
</script>

